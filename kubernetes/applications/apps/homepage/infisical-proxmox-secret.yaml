# Sync Proxmox API token from Infisical for Homepage
# Secret location in Infisical: /infrastructure/proxmox/API_TOKEN
apiVersion: secrets.infisical.com/v1alpha1
kind: InfisicalSecret
metadata:
  name: homepage-proxmox
  namespace: apps
spec:
  hostAPI: https://app.infisical.com/api

  authentication:
    universalAuth:
      credentialsRef:
        secretName: "universal-auth-credentials"
        secretNamespace: "infisical-operator-system"
      secretsScope:
        projectSlug: "homelab-test-5-ig-k"
        envSlug: "prod"
        secretsPath: "/infrastructure/proxmox"

  managedSecretReference:
    secretName: homepage-proxmox
    secretNamespace: apps
    secretType: Opaque
    creationPolicy: Owner

  # Map the Infisical secret key to the expected 'token' key
  secretKeyMapping:
    - secretKeyName: API_TOKEN
      kubernetesSecretKey: token
