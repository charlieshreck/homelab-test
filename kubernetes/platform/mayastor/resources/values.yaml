# Mayastor configuration for 3-node cluster with dual NICs
# Storage network: 10.11.0.0/24

# Use huge pages (configured in Talos with vm.nr_hugepages=1024)
io_engine:
  hugepages:
    enabled: true

# Use all 3 worker nodes for Mayastor
agents:
  core:
    nodeSelector:
      openebs.io/engine: mayastor

# Storage pool configuration
# Each worker has a dedicated disk /dev/sdb for Mayastor (helford storage - 1TB total, ~300GB per node)
# DiskPools are automatically created via diskpools.yaml (deployed by ArgoCD)

# Resource limits appropriate for 9GB RAM per node
csi:
  node:
    resources:
      limits:
        cpu: "1"
        memory: "512Mi"
      requests:
        cpu: "100m"
        memory: "128Mi"

# Enable etcd for Mayastor control plane
# Use emptyDir instead of PVCs to avoid bootstrap chicken-and-egg problem
etcd:
  replicaCount: 3
  persistence:
    enabled: false  # Disable PVCs - etcd uses emptyDir with 3x replication
  image:
    registry: docker.io
    repository: bitnami/etcd
    tag: 3.5.15-debian-12-r5  # Override with current valid tag

# Disable Loki (observability) - also needs storage, not required for core functionality
loki:
  enabled: false

# Enable metrics
metrics:
  enabled: true
