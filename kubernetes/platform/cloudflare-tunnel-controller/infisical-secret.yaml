# Sync Cloudflare credentials from Infisical
# Expected keys in Infisical at /kubernetes/cloudflare-tunnel/:
# - CLOUDFLARE_API_TOKEN (reuse from cert-manager or create new)
# - CLOUDFLARE_ACCOUNT_ID: 9a7a5c367a6dd8a2e39c89f1e24db208
# - CLOUDFLARE_TUNNEL_ID: 51b2231f-8d36-4795-a706-7405da8ea3d9
apiVersion: secrets.infisical.com/v1alpha1
kind: InfisicalSecret
metadata:
  name: cloudflare-tunnel-credentials
  namespace: cloudflare-tunnel-controller
spec:
  hostAPI: https://app.infisical.com/api

  authentication:
    universalAuth:
      credentialsRef:
        secretName: "universal-auth-credentials"
        secretNamespace: "infisical-operator-system"
      secretsScope:
        projectSlug: "homelab-test-5-ig-k"
        envSlug: "prod"
        secretsPath: "/kubernetes/cloudflare-tunnel"

  managedSecretReference:
    secretName: cloudflare-tunnel-credentials
    secretNamespace: cloudflare-tunnel-controller
    secretType: Opaque
    creationPolicy: Owner
