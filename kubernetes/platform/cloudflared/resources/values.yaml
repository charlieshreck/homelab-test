replicaCount: 2

image:
  repository: cloudflare/cloudflared
  tag: latest
  pullPolicy: Always

resources:
  requests:
    cpu: 10m
    memory: 64Mi
  limits:
    memory: 128Mi

config:
  ingress:
    # ArgoCD
    - hostname: argocd.shreck.io
      service: https://traefik-traefik.traefik.svc.cluster.local:443
      originRequest:
        originServerName: shreck.io
        noTLSVerify: false
        http2Origin: true
    
    # Longhorn
    - hostname: longhorn.shreck.io
      service: https://traefik-traefik.traefik.svc.cluster.local:443
      originRequest:
        originServerName: shreck.io
        noTLSVerify: false
        http2Origin: true
    
    # Wildcard catch-all for other *.shreck.io
    - hostname: "*.shreck.io"
      service: https://traefik-traefik.traefik.svc.cluster.local:443
      originRequest:
        originServerName: shreck.io
        noTLSVerify: false
        http2Origin: true
    
    # Default 404
    - service: http_status:404

affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchLabels:
              app.kubernetes.io/name: cloudflared
          topologyKey: kubernetes.io/hostname