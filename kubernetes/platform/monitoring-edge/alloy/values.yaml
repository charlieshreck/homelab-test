# Grafana Alloy - Unified Telemetry Collector
# Version: 1.5.0

alloy:
  # Configuration from ConfigMap
  configMap:
    create: true
    content: ""  # Will be overridden by external ConfigMap

  # Mode: DaemonSet to run on every node
  mode: daemonset

  # Stability level
  stabilityLevel: "generally-available"

  # Resource configuration
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

  # Security context
  securityContext:
    privileged: false
    runAsUser: 0  # Required for reading container logs
    runAsGroup: 0
    fsGroup: 0

  # Service account
  serviceAccount:
    create: true
    name: alloy

# Controller settings
controller:
  type: daemonset

  # Update strategy
  updateStrategy:
    type: RollingUpdate
    rollingUpdate:
      maxUnavailable: 1

  # Host networking for better performance
  hostNetwork: false

  # Host PID for eBPF (optional, disabled for now)
  hostPID: false

  # Volumes
  volumes:
    - name: config
      configMap:
        name: alloy-config
    - name: varlog
      hostPath:
        path: /var/log
    - name: varlibdockercontainers
      hostPath:
        path: /var/lib/docker/containers
    - name: etcmachineid
      hostPath:
        path: /etc/machine-id

  volumeMounts:
    - name: config
      mountPath: /etc/alloy
    - name: varlog
      mountPath: /var/log
      readOnly: true
    - name: varlibdockercontainers
      mountPath: /var/lib/docker/containers
      readOnly: true
    - name: etcmachineid
      mountPath: /etc/machine-id
      readOnly: true

# RBAC
rbac:
  create: true

# Service
service:
  enabled: true
  type: ClusterIP
  port: 12345  # Alloy UI port

# ServiceMonitor (disabled - no Prometheus Operator)
serviceMonitor:
  enabled: false
