# Grafana Tempo - Distributed Tracing Storage
# Version: 2.6.3

tempo:
  # Storage configuration
  storage:
    trace:
      backend: local
      local:
        path: /var/tempo/traces

  # Retention
  retention: 336h  # 14 days

  # Receivers - accept traces from various protocols
  receivers:
    otlp:
      protocols:
        grpc:
          endpoint: 0.0.0.0:4317
        http:
          endpoint: 0.0.0.0:4318
    jaeger:
      protocols:
        grpc:
          endpoint: 0.0.0.0:14250
        thrift_http:
          endpoint: 0.0.0.0:14268

  # Metrics generation from traces
  metrics_generator:
    enabled: true
    storage:
      path: /var/tempo/generator
    # Generate RED metrics automatically
    registry:
      external_labels:
        source: tempo
    # Push to Mimir
    remote_write:
      - url: http://mimir.monitoring.svc:8080/api/v1/push

# Resource configuration
resources:
  requests:
    cpu: 200m
    memory: 512Mi
  limits:
    cpu: 1000m
    memory: 1Gi

# Persistence
persistence:
  enabled: true
  storageClass: mayastor-2
  size: 30Gi

# Service configuration
service:
  type: ClusterIP

# Enable metrics about Tempo itself
serviceMonitor:
  enabled: false  # No Prometheus Operator in this stack

# Compactor for trace storage
compactor:
  config:
    compaction:
      block_retention: 336h  # 14 days

# Query frontend
queryFrontend:
  replicas: 1
