# VMAlert - Alert Rule Evaluation for VictoriaMetrics
# Chart: victoria-metrics-alert from vm/victoria-metrics-alert

# Data source (VictoriaMetrics)
server:
  datasource:
    url: http://victoria-metrics-single-server.monitoring.svc:8428

  # Alert manager URL
  notifier:
    alertmanager:
      url: http://alertmanager.monitoring.svc:9093

  # Resource limits
  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi

  # Extra args
  extraArgs:
    evaluationInterval: 30s

  # Alert rules configuration (required - at least one rule needed)
  config:
    alerts:
      groups:
        - name: basic-alerts
          rules:
            # Node down alert
            - alert: NodeDown
              expr: up{job="kubernetes-nodes"} == 0
              for: 5m
              labels:
                severity: critical
              annotations:
                summary: "Node {{ $labels.instance }} is down"
                description: "Node {{ $labels.instance }} has been down for more than 5 minutes"

            # High memory usage
            - alert: HighMemoryUsage
              expr: (1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100 > 85
              for: 5m
              labels:
                severity: warning
              annotations:
                summary: "High memory usage on {{ $labels.instance }}"
                description: "Memory usage is above 85% on {{ $labels.instance }}"

            # Pod restarts
            - alert: PodRestartingFrequently
              expr: rate(kube_pod_container_status_restarts_total[15m]) > 0.2
              for: 5m
              labels:
                severity: warning
              annotations:
                summary: "Pod {{ $labels.namespace }}/{{ $labels.pod }} restarting frequently"
                description: "Pod has restarted {{ $value }} times in the last 15 minutes"

# Config reloader
configReloader:
  enabled: true

# RBAC
rbac:
  create: true

# Service Account
serviceAccount:
  create: true
  name: vmalert

# Service Monitor - disabled, no Prometheus Operator
serviceMonitor:
  enabled: false
